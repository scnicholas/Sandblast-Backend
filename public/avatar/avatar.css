/* avatar.css
 *
 * v1.4.0 (HERO-CINEMA++++ + PHASE1-SKIN ALIGN++++ + BLACK-WASH KILL++++)
 *
 * Mission:
 * - Make the hero feel cinematic (face-first, not flat)
 * - Prevent “black slab / black wash” (overlays never smother the hero)
 * - Align styling with Phase 1 Clean host (nyxStage / nyxDock / chips / bubble)
 * - Keep legacy IDs harmless (no surprises if older mounts exist)
 *
 * Notes:
 * - Phase 1 host uses CSS vars: --nyx-hero-pos-x/y, --nyx-hero-scale-num, --nyx-hero-dim
 * - Legacy shell uses: --hero-pos / --nyx-hero-url / --nyx-hero-abs
 */

/* ============================================================
   CORE VARIABLES
============================================================ */
:root{
  /* Base palette */
  --bg:#000000;
  --text:rgba(255,255,255,.96);
  --muted:rgba(255,255,255,.74);

  /* Brand accent */
  --accent:rgba(140,0,35,.92);
  --accent-soft:rgba(140,0,35,.26);

  /* Safe areas */
  --safe-b: env(safe-area-inset-bottom, 0px);
  --safe-r: env(safe-area-inset-right, 0px);
  --safe-l: env(safe-area-inset-left, 0px);

  /* ==========================================================
     HERO SOURCES
     - Video first; PNG fallback
  ========================================================== */
  --nyx-hero-video-src:"https://sandblast-backend.onrender.com/avatar/assets/avatar3.mp4";
  --nyx-hero-src:"https://sandblast-backend.onrender.com/avatar/assets/nyx-hero.png";
  --nyx-hero-abs:url("https://sandblast-backend.onrender.com/avatar/assets/nyx-hero.png");
  --nyx-hero-url:var(--nyx-hero-abs);

  /* Phase 1 host compatibility (used by avatar-host_UPDATED.html) */
  --nyx-hero-video: "https://sandblast-backend.onrender.com/avatar/assets/avatar3.mp4";
  --nyx-hero-img-url: "https://sandblast-backend.onrender.com/avatar/assets/nyx-hero.png";

  /* Face-first framing */
  --nyx-hero-pos-x: 50%;
  --nyx-hero-pos-y: 12%;
  --nyx-hero-scale-num: 1.22;

  /* Legacy framing fallback */
  --hero-pos: 50% 18%;
  --hero-scale: cover;
  --hero-opacity: 1;

  /* Video tuning */
  --hero-video-fit: cover;
  --hero-video-scale: 1.00;
  --hero-video-bright: 1.00;
  --hero-video-contrast: 1.06;
  --hero-video-sat: 1.06;

  /* ==========================================================
     CINEMATIC OVERLAYS (BLACK-WASH KILL)
     - Keep eyes dominant: dim is subtle, vignette is soft
  ========================================================== */
  --nyx-hero-dim: .10;            /* Phase 1 dim (lower = more hero presence) */
  --shoulder-shadow: rgba(0,0,0,.88);
  --face-spot: rgba(255,255,255,.07);
  --vignette: rgba(0,0,0,.62);

  /* UI Glass */
  --ui-glass-1: rgba(18,18,22,.62);
  --ui-glass-2: rgba(10,10,14,.82);
  --ui-line: rgba(255,255,255,.11);
  --ui-line-soft: rgba(255,255,255,.07);

  /* Bubble */
  --bubble-alpha: .58;
  --bubble-blur: 14px;
  --bubble-shadow: 0 24px 70px rgba(0,0,0,.72);
  --bubble-anchor-x: 50%;
  --bubble-anchor-y: 70%;
  --bubble-max-h: min(46vh, 360px);
  --bubble-text-max-h: min(32vh, 240px);

  /* Top chrome */
  --chrome-scale: .86;
  --chrome-idle-opacity: .62;
  --chrome-hover-opacity: .92;

  --ease: cubic-bezier(.2,.8,.2,1);
}

*{ box-sizing:border-box; }
html,body{ height:100%; background:#000 !important; }
body{
  margin:0;
  font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:#000 !important;
  color:var(--text);
  overflow:hidden;
}

/* ============================================================
   LEGACY HERO STAGE (if present)
============================================================ */
#avatarRoot{
  position:relative;
  height:100%;
  background:#000 !important;
  isolation:isolate;
  overflow:hidden;
}

#nyxShellMount{
  position:absolute;
  inset:0;
  background-color:#000 !important;
  background-image:
    var(--nyx-hero-url),
    var(--nyx-hero-abs),
    url(var(--nyx-hero-src)) !important;
  background-repeat:no-repeat !important;
  background-position:var(--hero-pos) !important;
  background-size:var(--hero-scale) !important;
  opacity:var(--hero-opacity) !important;
  z-index:1;
}

/* Cinematic overlay (never smother the face) */
#nyxShellMount::after{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background:
    /* Shoulder floor */
    linear-gradient(to top,
      var(--shoulder-shadow) 0%,
      rgba(0,0,0,.68) 18%,
      rgba(0,0,0,0) 46%
    ),
    /* Face spot */
    radial-gradient(44% 32% at 50% 22%,
      var(--face-spot) 0%,
      rgba(255,255,255,0) 70%
    ),
    /* Soft vignette */
    radial-gradient(130% 110% at 50% 46%,
      rgba(0,0,0,0) 56%,
      var(--vignette) 100%
    );
  opacity: 1;
}

/* Video support (legacy mounts) */
#nyxStage video,
#nyxShellMount video{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:var(--hero-video-fit);
  object-position:var(--hero-pos);
  transform:scale(var(--hero-video-scale));
  filter:
    brightness(var(--hero-video-bright))
    contrast(var(--hero-video-contrast))
    saturate(var(--hero-video-sat));
  opacity:var(--hero-opacity);
  z-index:1;
  pointer-events:none;
}

/* ============================================================
   OVERLAY AUTHORITY (legacy ids)
============================================================ */
#nyxOverlay,
.overlay{
  position:absolute;
  inset:0;
  z-index:2147483000;
  pointer-events:none;
}

/* allow interaction */
#nyxBubble,
#nyxInputDock,
#nyxBubbleActions{
  pointer-events:auto;
}

/* ============================================================
   SHOULDER-ANCHORED BUBBLE (legacy ids)
============================================================ */
#nyxBubble{
  display:flex;
  flex-direction:column;
  max-height: var(--bubble-max-h);
  overflow:hidden;

  position:absolute !important;
  left:var(--bubble-anchor-x) !important;
  top:var(--bubble-anchor-y) !important;
  transform:translate(-50%,-50%) !important;

  width:min(560px,92%) !important;

  background:
    radial-gradient(120% 140% at 50% 0%,
      rgba(255,255,255,.05) 0%,
      rgba(255,255,255,0) 42%),
    linear-gradient(145deg, var(--ui-glass-1), var(--ui-glass-2));

  border:1px solid rgba(255,255,255,.12);
  border-radius:20px;
  box-shadow:var(--bubble-shadow);
  backdrop-filter:blur(var(--bubble-blur));
  -webkit-backdrop-filter:blur(var(--bubble-blur));
}

#nyxBubbleText{
  flex:1 1 auto;
  max-height: var(--bubble-text-max-h);
  overflow:auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: thin;

  padding:16px 20px 12px 20px;
  font-size:15.4px;
  line-height:1.6;
  color:rgba(255,255,255,.96);
}

/* ============================================================
   ADAPTIVE CHIPS (legacy ids)
============================================================ */
#nyxBubbleActions{
  display:flex;
  gap:8px;
  padding:0 14px 12px 14px;
  overflow-x:auto;
  border-top:1px solid rgba(255,255,255,.05);
  margin-top:4px;
  padding-top:12px;
  transition:opacity .22s ease, transform .22s ease, filter .22s ease;
}
html.nyx-chips-hidden #nyxBubbleActions{
  opacity:0;
  transform:translateY(6px);
  pointer-events:none;
  filter:blur(1.5px);
}
html.nyx-chips-shown #nyxBubbleActions{
  opacity:1;
  transform:translateY(0);
}

/* ============================================================
   INPUT DOCK (legacy ids)
============================================================ */
#nyxInputDock{
  position:absolute !important;
  left:50% !important;
  transform:translateX(-50%) !important;
  bottom: calc(16px + var(--safe-b)) !important;

  width:min(620px,94%) !important;
  display:flex;
  gap:10px;

  padding:10px;
  border-radius:18px;

  background:rgba(12,12,16,.74);
  border:1px solid rgba(255,255,255,.11);
  box-shadow:0 18px 60px rgba(0,0,0,.78);
  backdrop-filter:blur(16px);
}

/* ============================================================
   REDUCED TOP CHROME
============================================================ */
.nyx-topbar,
#nyxTopbar,
.nyx-controls{
  transform:scale(var(--chrome-scale));
  transform-origin:top right;
  opacity:var(--chrome-idle-opacity);
  transition:opacity .18s ease, transform .18s ease;
}
.nyx-topbar:hover,
#nyxTopbar:hover,
.nyx-controls:hover{
  opacity:var(--chrome-hover-opacity);
}

/* ============================================================
   MICRO-PAUSE PULSE
============================================================ */
@keyframes nyxPulse{
  0%{filter:brightness(1) saturate(1);}
  50%{filter:brightness(1.06) saturate(1.05);}
  100%{filter:brightness(1) saturate(1);}
}
html.nyx-thinking #avatarRoot{
  animation: nyxPulse .55s ease-in-out 1;
}

/* ============================================================
   PHASE 1 — CLEAN HOST SKIN (avatar-host_UPDATED.html)
============================================================ */

/* Hero image fallback for Phase 1 host */
body.nyx-phase1 #nyxStage.is-image{
  background-image: url(var(--nyx-hero-img-url)) !important;
  background-size: 132% auto !important;
  background-position: var(--nyx-hero-pos-x,50%) var(--nyx-hero-pos-y,12%) !important;
}

/* Phase 1 hero overlay tuned (subtle dim only) */
body.nyx-phase1 #nyxStage::after{
  opacity: var(--nyx-hero-dim, .10) !important;
}

/* Dock: premium matte, readable hierarchy */
body.nyx-phase1 #nyxDock{
  border-color: rgba(255,255,255,.08) !important;
  background: rgba(12,12,16,.78) !important;
  box-shadow: 0 22px 80px rgba(0,0,0,.74), 0 0 70px rgba(140,0,35,.12) !important;
}
body.nyx-phase1 #nyxDockHeader{
  background: linear-gradient(180deg, rgba(0,0,0,.30), rgba(0,0,0,0)) !important;
}
body.nyx-phase1 #nyxTitle{
  letter-spacing: .25px !important;
}

/* Messages: crisp cards; ONLY nyxScroll scrolls */
body.nyx-phase1 .nyx-msg{
  border-color: rgba(255,255,255,.09) !important;
  background: rgba(0,0,0,.24) !important;
  max-height:none !important;
  overflow:visible !important;
}
body.nyx-phase1 .nyx-msg.me{
  background: rgba(140,0,35,.20) !important;
  border-color: rgba(140,0,35,.30) !important;
}

/* Chips: tighter + richer contrast */
body.nyx-phase1 #nyxChips{
  padding: 10px 12px !important;
  border-bottom: 1px solid rgba(255,255,255,.06) !important;
  gap: 10px !important;
}
body.nyx-phase1 .chip{
  background: rgba(255,255,255,.055) !important;
  border-color: rgba(255,255,255,.13) !important;
}
body.nyx-phase1 .chip:hover{
  background: rgba(140,0,35,.14) !important;
  border-color: rgba(140,0,35,.55) !important;
}
body.nyx-phase1 .chip.is-active{
  background: rgba(140,0,35,.24) !important;
  border-color: rgba(140,0,35,.62) !important;
}

/* Input: better UX edge + focus ring */
body.nyx-phase1 #nyxInput{
  border-color: rgba(255,255,255,.12) !important;
}
body.nyx-phase1 #nyxInput:focus{
  border-color: rgba(255,255,255,.18) !important;
  box-shadow: 0 0 0 3px rgba(140,0,35,.14) !important;
}

/* Optional: hide any legacy page-bottom banners if injected inside iframe */
body.nyx-phase1 .nyx-bottom-banner,
body.nyx-phase1 #nyxBottomBanner,
body.nyx-phase1 #sbnyxBottomBanner{
  display:none !important;
}

/* Compact widget: keep face clean */
@media (max-width: 520px){
  body.nyx-phase1 #nyxBubble{ display:none !important; }
}

/* Low-height tuning */
@media (max-height: 620px){
  :root{
    --hero-pos: 50% 24%;
    --nyx-hero-pos-y: 16%;
  }
  #nyxBubble{ top: 70% !important; }
}

/* Reduced motion: prefer image stage */
@media (prefers-reduced-motion: reduce){
  #nyxStage video,
  #nyxShellMount video{
    display:none !important;
  }
}



/* ======================================================================
   v1.4.1 PATCH (NAV VEIL VISUAL + PARALLAX DRIFT)
   - Goal: produce an immediate visible change WITHOUT requiring new HTML.
   - Implements a semi-transparent "channel veil" as a pseudo-layer on #nyxStage.
   - Interactive clicks require a real element + JS (cannot be done purely in CSS).
====================================================================== */

/* Tunables (safe defaults) */
:root{
  --nyx-veil-w: min(240px, 22vw);
  --nyx-veil-opacity: .78;
  --nyx-veil-blur: 10px;

  /* optional JS-driven drift hooks (safe at 0) */
  --nyx-parallax-x: 0px;
  --nyx-parallax-y: 0px;
  --nyx-parallax-tilt: 0deg;

  /* motion */
  --nyx-veil-drift: 1; /* set to 0 to freeze */
}

/* Allow a quick kill-switch */
html.nyx-veil-off :is(#nyxStage, #avatarRoot, #wrap) .nyx-nav-veil,
html.nyx-veil-off body.nyx-phase1 #nyxStage::after{
  display:none !important;
}

/* Ensure #nyxStage can host pseudo layers */
body.nyx-phase1 #nyxStage{ position:relative; isolation:isolate; }

/* Visual veil sits ABOVE hero image, BELOW UI cards */
body.nyx-phase1 #nyxStage::after{
  content:"";
  position:absolute;
  left:0;
  top:0;
  bottom:0;
  width: var(--nyx-veil-w);
  z-index: 2;                 /* stage layer */
  pointer-events:none;        /* visual-only in CSS-only mode */

  /* "dark glass" with subtle accent bloom */
  background:
    linear-gradient(180deg, rgba(8,8,12,.64), rgba(8,8,12,.44)),
    radial-gradient(700px 520px at 25% 18%, rgba(140,0,35,.20), transparent 60%),
    radial-gradient(540px 380px at 40% 62%, rgba(255,255,255,.08), transparent 62%);

  border-right: 1px solid rgba(255,255,255,.10);

  /* glass effect */
  -webkit-backdrop-filter: blur(var(--nyx-veil-blur));
  backdrop-filter: blur(var(--nyx-veil-blur));

  opacity: var(--nyx-veil-opacity);

  /* mild drift: breathing + optional JS offsets */
  transform:
    translate3d(var(--nyx-parallax-x), var(--nyx-parallax-y), 0)
    rotate(var(--nyx-parallax-tilt))
    translate3d(0, 0, 0);

  transition: transform 140ms var(--nyx-ease);
}

/* Soft motion that reads as "alive" but not distracting */
@keyframes nyxVeilDrift{
  0%   { transform: translate3d(var(--nyx-parallax-x), calc(var(--nyx-parallax-y) + 0px), 0) rotate(var(--nyx-parallax-tilt)); }
  50%  { transform: translate3d(var(--nyx-parallax-x), calc(var(--nyx-parallax-y) + 10px), 0) rotate(var(--nyx-parallax-tilt)); }
  100% { transform: translate3d(var(--nyx-parallax-x), calc(var(--nyx-parallax-y) + 0px), 0) rotate(var(--nyx-parallax-tilt)); }
}

@media (prefers-reduced-motion: no-preference){
  body.nyx-phase1 #nyxStage::after{
    animation: nyxVeilDrift calc(9s + (1s * (1 - var(--nyx-veil-drift)))) var(--nyx-ease) infinite;
  }
}
@media (prefers-reduced-motion: reduce){
  body.nyx-phase1 #nyxStage::after{ animation:none !important; }
}

/* Mobile: keep it subtle and out of the way */
@media (max-width: 780px){
  :root{ --nyx-veil-w: min(210px, 38vw); --nyx-veil-opacity: .68; }
}
@media (max-width: 520px){
  :root{ --nyx-veil-w: min(170px, 46vw); --nyx-veil-opacity: .62; }
}
