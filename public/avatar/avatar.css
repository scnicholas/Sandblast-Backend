/* avatar.css
 *
 * v1.4.0 (PHASE1 DOCK LAYOUT++++ + HERO SACRED++++ + VOICE GATE++++ + SCROLL CONTAIN++++)
 *
 * Upgrades:
 * - Top chrome reduced ~30% visual weight
 * - Dialogue anchored to shoulder level (no center slab)
 * - Bubble opacity lowered so eyes dominate
 * - Chips adaptive-ready (CSS state classes)
 * - Micro-pause pulse animation support
 * - MP4 hero + PNG fallback preserved
 */

/* ============================================================
   CORE VARIABLES
============================================================ */
:root{
  --bg:#000000;
  --text:rgba(255,255,255,.96);
  --muted:rgba(255,255,255,.75);

  /* HERO SOURCES */
  --nyx-hero-video-src:"https://sandblast-backend.onrender.com/avatar/assets/avatar3.mp4";
  --nyx-hero-src:"https://sandblast-backend.onrender.com/avatar/assets/nyx-hero.png";
  --nyx-hero-abs:url("https://sandblast-backend.onrender.com/avatar/assets/nyx-hero.png");
  --nyx-hero-url:var(--nyx-hero-abs);

  --hero-pos:50% 22%;
  --hero-scale:cover;
  --hero-opacity:1;

  --hero-video-fit:cover;
  --hero-video-scale:1.00;
  --hero-video-bright:1.00;
  --hero-video-contrast:1.06;
  --hero-video-sat:1.05;

  --shoulder-shadow:rgba(0,0,0,.92);
  --face-spot:rgba(255,255,255,.06);
  --vignette:rgba(0,0,0,.76);

  /* UI Glass */
  --ui-glass-1:rgba(24,24,30,.78);   /* lowered opacity */
  --ui-glass-2:rgba(14,14,20,.88);
  --ui-line:rgba(255,255,255,.11);
  --ui-line-soft:rgba(255,255,255,.07);

  --accent:rgba(140,0,35,.92);
  --accent-soft:rgba(140,0,35,.28);

  /* Presence Tuning */
  --bubble-alpha:.60;
  --bubble-blur:14px;
  --bubble-shadow:0 24px 70px rgba(0,0,0,.75);

  --bubble-anchor-x:50%;
  --bubble-anchor-y: 70%;
  --bubble-max-h: min(46vh, 360px);
  --bubble-text-max-h: min(32vh, 240px);

  --chrome-scale:.86;
  --chrome-idle-opacity:.60;
  --chrome-hover-opacity:.92;

  --ease:cubic-bezier(.2,.8,.2,1);
}

*{box-sizing:border-box}
html,body{height:100%;background:#000 !important}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:#000 !important;
  color:var(--text);
  overflow:hidden;
}

/* ============================================================
   PHASE 1 — NYX 3.0 HOST LAYOUT (HERO SACRED + DOCK + SCROLL)
   Targets the Phase1 avatar-host.html structure:
     #nyxApp / #nyxHero / #nyxHeroBg / #nyxBubble / #nyxDock / #nyxScroll
   Notes:
   - Safe to coexist with legacy (#avatarRoot/#nyxShellMount) styles
============================================================ */

/* App grid (hero left, dock right) */
#nyxApp{
  height:100vh;
  display:grid;
  grid-template-columns: 1fr 360px;
  gap:12px;
  padding:12px;
  box-sizing:border-box;
  background:#000;
}

/* HERO = sacred zone (never scrolls, never gets covered) */
#nyxHero{
  position:relative;
  border-radius:22px;
  overflow:hidden;
  border:1px solid var(--ui-line-soft);
  background:#000;
  isolation:isolate;
  min-height:520px;
}

/* Hero background uses same variable contract as legacy */
#nyxHeroBg{
  position:absolute; inset:0;
  background-color:#000;
  background-image:
    var(--nyx-hero-url),
    var(--nyx-hero-abs),
    url(var(--nyx-hero-src));
  background-repeat:no-repeat;
  background-position: var(--hero-pos);
  background-size: var(--hero-scale);
  opacity: var(--hero-opacity);
  transform: translateZ(0);
}

/* Hero overlays (face spot + vignette + shoulder shadow) */
#nyxHeroBg::after{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background:
    linear-gradient(to top,
      var(--shoulder-shadow) 0%,
      rgba(0,0,0,.70) 18%,
      rgba(0,0,0,0) 46%
    ),
    radial-gradient(40% 28% at 50% 22%,
      var(--face-spot) 0%,
      rgba(255,255,255,0) 68%
    ),
    radial-gradient(120% 100% at 50% 50%,
      rgba(0,0,0,0) 52%,
      var(--vignette) 100%
    );
}

/* Top controls (voice toggle etc.) */
#nyxTopControls{
  position:absolute;
  top:12px; right:12px;
  z-index:6;
  display:flex;
  gap:8px;
  pointer-events:auto;
}

#nyxVoiceBtn{
  font: 12px system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  border-radius:14px;
  padding:8px 10px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(18,18,22,.55);
  color: rgba(255,255,255,.92);
  cursor:pointer;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  transition: opacity .18s var(--ease), transform .18s var(--ease);
}
#nyxVoiceBtn:hover{ opacity:.96; transform: translateY(-1px); }

/* Bubble stays in shoulder zone; never reaches face */
#nyxHero #nyxBubble{
  position:absolute !important;
  left:18px !important;
  right:18px !important;
  bottom:18px !important;
  top:auto !important;
  transform:none !important;
  z-index:5;

  width:auto !important;
  max-width: 92%;
  max-height: min(32vh, 280px); /* stricter clamp to protect face */
  overflow:hidden;

  background:
    radial-gradient(120% 140% at 50% 0%,
      rgba(255,255,255,.05) 0%,
      rgba(255,255,255,0) 42%),
    linear-gradient(145deg, var(--ui-glass-1), var(--ui-glass-2));

  border:1px solid rgba(255,255,255,.12);
  border-radius:20px;
  box-shadow:var(--bubble-shadow);
  backdrop-filter:blur(var(--bubble-blur));
  -webkit-backdrop-filter:blur(var(--bubble-blur));
}

/* Bubble text scroll clamp */
#nyxHero #nyxBubbleText{
  max-height: min(20vh, 180px);
  overflow:auto;
  -webkit-overflow-scrolling: touch;
  padding:14px 16px 10px 16px;
  font-size:15px;
  line-height:1.55;
  color:rgba(255,255,255,.96);
}

/* Bubble actions rail */
#nyxHero #nyxBubbleActions{
  display:flex;
  gap:8px;
  padding:10px 12px 12px 12px;
  overflow-x:auto;
  border-top:1px solid rgba(255,255,255,.05);
}

/* Dock panel */
#nyxDock{
  position:relative;
  border-radius:22px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.08);
  background: rgba(12,12,16,.78);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  box-shadow: 0 22px 80px rgba(0,0,0,.72);
  display:flex;
  flex-direction:column;
  min-height:520px;
}

/* Dock header badge */
#nyxDockHeader{
  padding:12px;
  border-bottom:1px solid rgba(255,255,255,.08);
}
#nyxBadge{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  font:12px system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  color:rgba(255,255,255,.78);
}
#nyxBadge b{ color:rgba(255,255,255,.95); font-weight:700; }

/* Scroll-contained message viewport (only this scrolls) */
#nyxScroll{
  flex: 1 1 auto;
  min-height: 0;
  overflow:auto;
  padding:12px;
}
#nyxMsgs{
  display:flex;
  flex-direction:column;
  gap:10px;
}

/* Basic message styling (safe defaults; JS can add classes) */
.nyx-msg{
  max-width: 92%;
  padding:10px 12px;
  border-radius: 16px;
  border:1px solid rgba(255,255,255,.08);
  background: rgba(0,0,0,.26);
  color: rgba(255,255,255,.92);
  font: 13.5px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
}
.nyx-msg.me{
  margin-left:auto;
  background: rgba(140,0,35,.22);
  border-color: rgba(140,0,35,.34);
}
.nyx-msg.nyx{
  margin-right:auto;
}

/* Input row anchored, safe-area aware */
#nyxInputRow{
  display:flex;
  gap:8px;
  padding:12px;
  border-top:1px solid rgba(255,255,255,.08);
  background: rgba(0,0,0,.20);
  padding-bottom: calc(12px + var(--safe-b));
}
#nyxInput{
  flex:1;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(0,0,0,.35);
  color: rgba(255,255,255,.92);
  padding:10px 12px;
  outline:none;
}
#nyxInput:focus{
  border-color: rgba(255,255,255,.16);
  box-shadow: 0 0 0 3px rgba(140,0,35,.12);
}
#nyxSend{
  border-radius:14px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(140,0,35,.85);
  color: rgba(255,255,255,.95);
  padding:10px 12px;
  cursor:pointer;
}
#nyxSend:hover{ filter:brightness(1.05); }

/* Voice gate CTA */
#nyxVoiceGate{
  position:absolute;
  left:12px; right:12px;
  bottom: calc(12px + var(--safe-b));
  z-index: 12;
  pointer-events:auto;
}
#nyxEnableVoice{
  width:100%;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(18,18,22,.70);
  color: rgba(255,255,255,.95);
  padding:12px;
  cursor:pointer;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

/* Responsive: collapse dock under hero for narrow widths */
@media (max-width: 980px){
  #nyxApp{
    grid-template-columns: 1fr;
    grid-template-rows: minmax(420px, 56vh) 1fr;
  }
  #nyxDock{ min-height: 340px; }
}


/* ============================================================
   HERO STAGE
============================================================ */
#avatarRoot{
  position:relative;
  height:100%;
  background:#000 !important;
  isolation:isolate;
  overflow:hidden;
}

/* ============================================================
   PHASE 1 — NYX 3.0 HOST LAYOUT (HERO SACRED + DOCK + SCROLL)
   Targets the Phase1 avatar-host.html structure:
     #nyxApp / #nyxHero / #nyxHeroBg / #nyxBubble / #nyxDock / #nyxScroll
   Notes:
   - Safe to coexist with legacy (#avatarRoot/#nyxShellMount) styles
============================================================ */

/* App grid (hero left, dock right) */
#nyxApp{
  height:100vh;
  display:grid;
  grid-template-columns: 1fr 360px;
  gap:12px;
  padding:12px;
  box-sizing:border-box;
  background:#000;
}

/* HERO = sacred zone (never scrolls, never gets covered) */
#nyxHero{
  position:relative;
  border-radius:22px;
  overflow:hidden;
  border:1px solid var(--ui-line-soft);
  background:#000;
  isolation:isolate;
  min-height:520px;
}

/* Hero background uses same variable contract as legacy */
#nyxHeroBg{
  position:absolute; inset:0;
  background-color:#000;
  background-image:
    var(--nyx-hero-url),
    var(--nyx-hero-abs),
    url(var(--nyx-hero-src));
  background-repeat:no-repeat;
  background-position: var(--hero-pos);
  background-size: var(--hero-scale);
  opacity: var(--hero-opacity);
  transform: translateZ(0);
}

/* Hero overlays (face spot + vignette + shoulder shadow) */
#nyxHeroBg::after{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background:
    linear-gradient(to top,
      var(--shoulder-shadow) 0%,
      rgba(0,0,0,.70) 18%,
      rgba(0,0,0,0) 46%
    ),
    radial-gradient(40% 28% at 50% 22%,
      var(--face-spot) 0%,
      rgba(255,255,255,0) 68%
    ),
    radial-gradient(120% 100% at 50% 50%,
      rgba(0,0,0,0) 52%,
      var(--vignette) 100%
    );
}

/* Top controls (voice toggle etc.) */
#nyxTopControls{
  position:absolute;
  top:12px; right:12px;
  z-index:6;
  display:flex;
  gap:8px;
  pointer-events:auto;
}

#nyxVoiceBtn{
  font: 12px system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  border-radius:14px;
  padding:8px 10px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(18,18,22,.55);
  color: rgba(255,255,255,.92);
  cursor:pointer;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  transition: opacity .18s var(--ease), transform .18s var(--ease);
}
#nyxVoiceBtn:hover{ opacity:.96; transform: translateY(-1px); }

/* Bubble stays in shoulder zone; never reaches face */
#nyxHero #nyxBubble{
  position:absolute !important;
  left:18px !important;
  right:18px !important;
  bottom:18px !important;
  top:auto !important;
  transform:none !important;
  z-index:5;

  width:auto !important;
  max-width: 92%;
  max-height: min(32vh, 280px); /* stricter clamp to protect face */
  overflow:hidden;

  background:
    radial-gradient(120% 140% at 50% 0%,
      rgba(255,255,255,.05) 0%,
      rgba(255,255,255,0) 42%),
    linear-gradient(145deg, var(--ui-glass-1), var(--ui-glass-2));

  border:1px solid rgba(255,255,255,.12);
  border-radius:20px;
  box-shadow:var(--bubble-shadow);
  backdrop-filter:blur(var(--bubble-blur));
  -webkit-backdrop-filter:blur(var(--bubble-blur));
}

/* Bubble text scroll clamp */
#nyxHero #nyxBubbleText{
  max-height: min(20vh, 180px);
  overflow:auto;
  -webkit-overflow-scrolling: touch;
  padding:14px 16px 10px 16px;
  font-size:15px;
  line-height:1.55;
  color:rgba(255,255,255,.96);
}

/* Bubble actions rail */
#nyxHero #nyxBubbleActions{
  display:flex;
  gap:8px;
  padding:10px 12px 12px 12px;
  overflow-x:auto;
  border-top:1px solid rgba(255,255,255,.05);
}

/* Dock panel */
#nyxDock{
  position:relative;
  border-radius:22px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.08);
  background: rgba(12,12,16,.78);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  box-shadow: 0 22px 80px rgba(0,0,0,.72);
  display:flex;
  flex-direction:column;
  min-height:520px;
}

/* Dock header badge */
#nyxDockHeader{
  padding:12px;
  border-bottom:1px solid rgba(255,255,255,.08);
}
#nyxBadge{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  font:12px system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  color:rgba(255,255,255,.78);
}
#nyxBadge b{ color:rgba(255,255,255,.95); font-weight:700; }

/* Scroll-contained message viewport (only this scrolls) */
#nyxScroll{
  flex: 1 1 auto;
  min-height: 0;
  overflow:auto;
  padding:12px;
}
#nyxMsgs{
  display:flex;
  flex-direction:column;
  gap:10px;
}

/* Basic message styling (safe defaults; JS can add classes) */
.nyx-msg{
  max-width: 92%;
  padding:10px 12px;
  border-radius: 16px;
  border:1px solid rgba(255,255,255,.08);
  background: rgba(0,0,0,.26);
  color: rgba(255,255,255,.92);
  font: 13.5px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
}
.nyx-msg.me{
  margin-left:auto;
  background: rgba(140,0,35,.22);
  border-color: rgba(140,0,35,.34);
}
.nyx-msg.nyx{
  margin-right:auto;
}

/* Input row anchored, safe-area aware */
#nyxInputRow{
  display:flex;
  gap:8px;
  padding:12px;
  border-top:1px solid rgba(255,255,255,.08);
  background: rgba(0,0,0,.20);
  padding-bottom: calc(12px + var(--safe-b));
}
#nyxInput{
  flex:1;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(0,0,0,.35);
  color: rgba(255,255,255,.92);
  padding:10px 12px;
  outline:none;
}
#nyxInput:focus{
  border-color: rgba(255,255,255,.16);
  box-shadow: 0 0 0 3px rgba(140,0,35,.12);
}
#nyxSend{
  border-radius:14px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(140,0,35,.85);
  color: rgba(255,255,255,.95);
  padding:10px 12px;
  cursor:pointer;
}
#nyxSend:hover{ filter:brightness(1.05); }

/* Voice gate CTA */
#nyxVoiceGate{
  position:absolute;
  left:12px; right:12px;
  bottom: calc(12px + var(--safe-b));
  z-index: 12;
  pointer-events:auto;
}
#nyxEnableVoice{
  width:100%;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(18,18,22,.70);
  color: rgba(255,255,255,.95);
  padding:12px;
  cursor:pointer;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

/* Responsive: collapse dock under hero for narrow widths */
@media (max-width: 980px){
  #nyxApp{
    grid-template-columns: 1fr;
    grid-template-rows: minmax(420px, 56vh) 1fr;
  }
  #nyxDock{ min-height: 340px; }
}


#nyxShellMount{
  position:absolute;
  inset:0;
  background-color:#000 !important;
  background-image:
    var(--nyx-hero-url),
    var(--nyx-hero-abs),
    url(var(--nyx-hero-src)) !important;
  background-repeat:no-repeat !important;
  background-position:var(--hero-pos) !important;
  background-size:var(--hero-scale) !important;
  opacity:var(--hero-opacity) !important;
  z-index:1;
}

#nyxShellMount::after{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background:
    linear-gradient(to top,
      var(--shoulder-shadow) 0%,
      rgba(0,0,0,.70) 18%,
      rgba(0,0,0,0) 46%
    ),
    radial-gradient(40% 28% at 50% 22%,
      var(--face-spot) 0%,
      rgba(255,255,255,0) 68%
    ),
    radial-gradient(120% 100% at 50% 50%,
      rgba(0,0,0,0) 52%,
      var(--vignette) 100%
    );
}

/* Video support */
#nyxStage video,
#nyxShellMount video{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:var(--hero-video-fit);
  object-position:var(--hero-pos);
  transform:scale(var(--hero-video-scale));
  filter:
    brightness(var(--hero-video-bright))
    contrast(var(--hero-video-contrast))
    saturate(var(--hero-video-sat));
  opacity:var(--hero-opacity);
  z-index:1;
  pointer-events:none;
}

/* ============================================================
   OVERLAY AUTHORITY
============================================================ */
#nyxOverlay,
.overlay{
  position:absolute;
  inset:0;
  z-index:2147483000;
  pointer-events:none;
}

#nyxBubble,
#nyxInputDock,
#nyxBubbleActions{
flex:0 0 auto;

  pointer-events:auto;
}

/* ============================================================
   SHOULDER-ANCHORED BUBBLE
============================================================ */
#nyxBubble{
display:flex;
  flex-direction:column;
  max-height: var(--bubble-max-h);
  overflow:hidden;

  position:absolute !important;
  left:var(--bubble-anchor-x) !important;
  top:var(--bubble-anchor-y) !important;
  transform:translate(-50%,-50%) !important;

  width:min(560px,92%) !important;

  background:
    radial-gradient(120% 140% at 50% 0%,
      rgba(255,255,255,.05) 0%,
      rgba(255,255,255,0) 42%),
    linear-gradient(145deg, var(--ui-glass-1), var(--ui-glass-2));

  border:1px solid rgba(255,255,255,.12);
  border-radius:20px;
  box-shadow:var(--bubble-shadow);
  backdrop-filter:blur(var(--bubble-blur));
  -webkit-backdrop-filter:blur(var(--bubble-blur));
}

#nyxBubbleText{
flex:1 1 auto;
  max-height: var(--bubble-text-max-h);
  overflow:auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: thin;

  padding:16px 20px 12px 20px;
  font-size:15.6px;
  line-height:1.6;
  color:rgba(255,255,255,.96);
}

/* ============================================================
   ADAPTIVE CHIPS
============================================================ */
#nyxBubbleActions{
  display:flex;
  gap:8px;
  padding:0 14px 12px 14px;
  overflow-x:auto;
  border-top:1px solid rgba(255,255,255,.05);
  margin-top:4px;
  padding-top:12px;
  transition:opacity .22s ease, transform .22s ease, filter .22s ease;
}

html.nyx-chips-hidden #nyxBubbleActions{
  opacity:0;
  transform:translateY(6px);
  pointer-events:none;
  filter:blur(1.5px);
}

html.nyx-chips-shown #nyxBubbleActions{
  opacity:1;
  transform:translateY(0);
}

/* ============================================================
   INPUT DOCK
============================================================ */
#nyxInputDock{
  position:absolute !important;
  left:50% !important;
  transform:translateX(-50%) !important;
  bottom: calc(16px + var(--safe-b)) !important;

  width:min(620px,94%) !important;
  display:flex;
  gap:10px;

  padding:10px;
  border-radius:18px;

  background:rgba(14,14,20,.82);
  border:1px solid rgba(255,255,255,.11);
  box-shadow:0 18px 60px rgba(0,0,0,.78);
  backdrop-filter:blur(16px);
}

/* ============================================================
   REDUCED TOP CHROME
============================================================ */
.nyx-topbar,
#nyxTopbar,
.nyx-controls{
  transform:scale(var(--chrome-scale));
  transform-origin:top right;
  opacity:var(--chrome-idle-opacity);
  transition:opacity .18s ease, transform .18s ease;
}

.nyx-topbar:hover,
#nyxTopbar:hover,
.nyx-controls:hover{
  opacity:var(--chrome-hover-opacity);
}

/* ============================================================
   MICRO-PAUSE PULSE
============================================================ */
@keyframes nyxPulse{
  0%{filter:brightness(1) saturate(1);}
  50%{filter:brightness(1.08) saturate(1.06);}
  100%{filter:brightness(1) saturate(1);}
}

html.nyx-thinking #avatarRoot{
  animation:nyxPulse .55s ease-in-out 1;
}

/* ============================================================
   RESPONSIVE
============================================================ */
@media (max-height:620px){
  :root{ --hero-pos:50% 26%; }
  #nyxBubble{ top:70% !important; }
}
